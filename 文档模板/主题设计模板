










自助机数据主题设计方案














文件状态：
[√] 草稿
[  ]正式发布
[  ]正在修改	文档编号：	
	当前版本：	V1.0
	编写人：	卓雪军	编写日期	2025-06-23
	审批人：		审批日期	
	保密级别：	
*文档编号：
*保密级别：绝密级、机密级、内部文件、公开级


文档修订记录
版本编号	变化状态	简要说明（变更内容和变更范围）	日期	编写人	审批人
V1.0	C	创建文档	2025-06-23	卓雪军	
					
					
*变化状态：C——创建，A——增加，M——修改，D——删除，A——审核


一、数仓分层治理规范
1、 数据分层说明：
数据分层	不同数据层存储数据说明
数据贴源层（ODS，对应DL）
（主题设计新增表暂不涉及该层，但原始的数据源会涉及该层）	ODS层保留原始数据，不作加工，实现数据由物理及逻辑分散到物理集中逻辑分散。
数据明细层（DWD，对应DC）
（主题设计新增表可能会涉及该层）	DWD层实现数据物理及逻辑集中，保持与ODS层相同的数据颗粒度；主要是对ODS数据层做一些数据的清洗、标准化和规范化的操作，比如去除空数据、脏数据、离群值等。
数据汇聚层（DWS，对应DM）
（主题设计新增表主要在该层）	整合汇总共性数据，提供通用指标，该层一般是宽表，用于提供后续的业务查询，OLAP分析，数据分发等。该层的数据表会相对较少，一张表会涵盖比较多的业务内容，由于其字段较多，因此一般也会称该层的表为宽表。
数据应用层（ADS，对应Cube、指标集）
（主题设计暂不涉及该层）	ADS层主要是提供给数据产品和数据分析使用的数据，面向具体业务场景，输出分析结果。

2、 数据模型要求：
数据层	设计要求	绘图要求
DWD层表	使用范式建模方法，可适当冗余字段。	实体关系图
DWS层表	使用维度建模方法	维度模型图

二、数据主题定义
1、 主题描述：
主题名称	自助机数据主题
数据范围	通过自助机产生的操作数据；来源业务系统：自助机系统、自助机报告统一打印服务、医技预约系统
支持的维度	维度表英文名	维度表中文描述	维度表英文名	维度表中文描述
		日期		自助机
		操作类型		自助机地址
	dim_hospitals	医院	dim_hosp_areas	医院院区
支持的度量	操作量
主题数据粒度	1、自助机系统记录的每日每台自助机不同类型的操作次数
2、医技预约系统中记录的每次操作
2、 数据规则
见《xx需求文档》中的3.2.

三、数据主题模型
1、数据流总览图
数据流图中以“库名.表名”表示一个表，包含“新增”表示需要新建的表，DWS层（MDR）中表名事实表与维度表，新增表具体的结构和对应的源库、源表、源字段信息在后面的表结构中说明。

2、主题数据模型
主题表设计根据数据库设计规范要求进行表及表字段命名。以下是对新增表的结构及源说明，其中用zzj表示自助机,dts表示明细。
2.1、ODS层需新增的数据表
ODS层需新增表对应的从库信息：
业务系统	从库操作系统	从库IP	数据库类型	数据库端口	业务数据库名
自助机报告统一打印服务	Win 2012 R2	10.100.21.76	MySql	3308	hxgy_selfprint
ODS层需新增表清单：
业务数据库名	表英文名	表中文名
hxgy_selfprint		
hxgy_selfprint		

2.2、DWD层需新增的数据表
2.1、自助机操作记录明细数据表，存放在库datacenter_db中，表英文名：zzj_operate_dts
字段名称	字段说明	字段类型	约束	备注	源库.源表.字段
operate_date	操作日期	date	必填	在自助机上进行操作的日期，格式：yyyy-mm-dd	自助机注册办卡、自助机门诊挂号、自助机门诊取号、自助机门诊缴费、自助机打印检查预约凭条、自助机补打缴费凭条、自助机补打挂号凭条、自助机打印门诊发票：
hid0101_mssql_zzj_zzj3.busicount.busidate
检查预约和改约：
hid0101_mysql_yjyy_yjyy.business_order.createtime
检查退号：
hid0101_mysql_yjyy_yjyy.business_order.updatetime
自助机打印医保结算单、自助机打印门诊缴费清单：

zzj_code	自助机编码	varchar	应填	因实际数据中有空的值，实际应该是必填。	自助机注册办卡、自助机门诊挂号、自助机门诊取号、自助机门诊缴费、自助机打印检查预约凭条、自助机补打缴费凭条、自助机补打挂号凭条、自助机打印门诊发票：
hid0101_mssql_zzj_zzj3.busicount.deviceno
检查预约、改约和退号：
hid0101_mysql_yjyy_yjyy.business_order.deviceno
自助机打印医保结算单、自助机打印门诊缴费清单：

sysflag	系统标识	varchar	必填	数据中心集成数据定义的业务系统编码字典表；数据中心表公共字段	根据实际集成的业务系统数据进行赋值
hosp_code	医院编码	varchar	必填	数据中心集成数据定义的医院编码字典表；数据中心表公共字段	根据实际集成哪个的医院数据进行赋值
md.dim_hospitals
hosp_area_code	院区编码	varchar	应填	运管定义的医院院区编码字典表，没有则给空值；数据中心表公共字段	md.dim_hosp_areas
isdeleted	是否删除	int	必填	数据是否物理删除标志，0表示正常，1表示删除；数据中心表公共字段	值跟随ODS层中主表的
isdeleted值
lastupdatedttm	最后更新时间	timestamp	必填	数据最后更新时间；数据中心表公共字段	取更新数据时的时间
rowkey	行唯一值	varchar	必填	唯一值；数据中心表公共字段	
因该表有多个数据来源，所以每个字段对应有多个源表.字段
2.3、DWS层需新增的数据表
自助机操作记录根据自助机编码与其他维度汇总表，存放在库m1中，表英文名：zzj_data_theme
主题的业务数据来自DWD的明细表，共同库名为datacenter_db，用#代替；字典数据来自字典库的字典表，共同库名为md。以下数据来源描述略去库名，查看或使用时根据是否字典数据判断数据来源对应的库名。
字段名称	字段说明	字段类型	约束	备注	源库.源表.字段
operate_date	操作日期	date	必填	在自助机上进行操作的日期，格式：yyyy-mm-dd	#.zzj_operate_dts.operDate
zzj_code	自助机编码	varchar	应填	因实际数据中有空的值，实际应该是必填	#.zzj_operate_dts.operate_date
zzjCreateBaseInfoQty	自助机注册办卡量	int	必填	患者通过自助机进行注册登记成功的量	
zzjRegisterQty	自助机门诊挂号量	int	必填	患者通过自助机进行门诊就诊预约挂号成功的量	
zzjGetNoQty	自助机门诊取号量	int	必填	患者通过自助机进行门诊就诊取号成功的量	
zzjPayFeesQty	自助机门诊缴费量	int	必填	患者通过自助机进行门诊缴费成功的量	
zzjCheckAppoibtmentQty	自助机检查预约量	int	必填		
zzjCheckAppoibtmentChangeQty	自助机检查改约量	int	必填		
	自助机检查退号量	int	必填		
	自助机打印检查预约凭条量	int	必填		
	自助机补打缴费凭条量	int	必填		
	自助机补打挂号凭条量	int	必填		
	自助机补打检查预约凭条量	int	必填		
	自助机打印报告量	int	必填		
	自助机打印门诊发票量	int	必填		
	自助机打印医保结算单量	int	必填		
	自助机打印门诊缴费清单量	int	必填		
hosp_code	医院编码	varchar	必填	数据中心集成数据定义的医院编码字典表；数据中心表公共字段	根据实际集成哪个的医院数据进行赋值
md.
hosp_area_code	院区编码	varchar	应填	运管定义的医院院区编码字典表，没有则给空值；数据中心表公共字段	
isdeleted	是否删除	int	必填	数据是否物理删除标志，0表示正常，1表示删除；数据中心表公共字段	值跟随ODS层中主表的
isdeleted值
lastupdatedttm	最后更新时间	timestamp	必填	数据最后更新时间；数据中心表公共字段	取更新数据时的时间
rowkey	行唯一值	varchar	必填	唯一值；数据中心表公共字段	

2.4、ADS层需新增的数据表
无
七、数据质量保障
1、质量规则：
质检规则	数据质量检测规则说明
完整性	日期缺失率等于0%，自助机编号缺失率需≤0.1%
一致性	①业务数据中记录的自助机编号需要与自助机字典中的自助机编号一致。
②跨系统数据（如：自助机系统中的自助机编号与医技预约系统中记录的自助机编号）需一致。
准确性	①明细数据量与业务系统明细数据量相等。
②根据数据统计规则准确计算统计数据量。
数据格式	①日期格式为yyyy-mm-dd。②日期时间格式为yyyy-mm-dd hh:mm:ss。
时序性	

2、监控与告警：
任务类型	监控与告警说明
数据集成任务	1、主题的数据集成任务纳入实时监控中。
2、任务异常时短信通知主题责任人，由责任人负责核查并处理异常任务。
数据质量任务	1、数据质量监控阈值纳入数据质量监控中。
2、任务或数据异常时短信通知主题责任人，由责任人负责核查并处理异常数据。

八、数据集成要求
数据集集成要求分类	数据集成具体要求说明
数据集成ETL任务	在每天的4点到23点59分之间以每20分钟执行一次的频率进行数据集成。
数据质检与补偿	每天0点10分开始进行一次数据质量检测，保存数据质量检测结果，对检测有异常的结果进行数据补偿，数据补偿完成之后再进行一次数据质量检测，保存数据质量检测结果，其中zzj_operate_dts的质量检测结果保存到checkres.chk_dc_zzj_operate_dts，zzj_dataTheme的检测结果保存到checkres.chk_mdr_zzj_dataTheme。

九、实施周期计划
序号	实施内容说明	人日/天
1	在datacenter_db中新增表zzj_operate_dts的ETL脚本开发	1
2	zzj_operate_dts的数据质量检测任务的ETL脚本开发	0.5
3	zzj_operate_dts的数据补偿任务的ETL脚本开发	0.2
4	zzj_operate_dts数据补偿后的数据质量检测任务的ETL脚本开发	0.2
5	在m1中新增表zzj_dataTheme的ETL脚本开发	0.5
6	zzj_dataTheme的数据质量检测任务的ETL脚本开发	0.5
7	zzj_dataTheme的数据补偿任务的ETL脚本开发	0.2
8	zzj_dataTheme数据补偿后的数据质量检测任务的ETL脚本开发	0.2
	合计	

十、风险评估与应对
序号	风险识别	应对策略
1	主题的维度不全或度量不准，导致不能支撑实际数据需求	主题责任人找出原因（一般为两类原因导致：设计与需求不符；实际需求变化），制定调整计划。当主题涉及与采集需求不符时，及时修改设计，然后重新集成数据。当实际需求变化时，先采集新的需求，再修改设计，之后再重新集成数据
2	主题数据来源不全，导致通过主题提供的数据不全	主题责任人通过与需求方、业务方全面了解数据来源，及时补充集成缺失的数据
3	主题数据质量问题，导致通过主题提供的数据异常	主题责任人核查问题原因，并给出解决方案，根据解决方案重新集成主题数据。同时修改数据质量检测方法
4	数据平台出问题，导致不支持提供数据服务	平台的设备、组件状态纳入监控，出现问题及时恢复
5	数据逻辑复杂，导致实施周期超出预期	遇到复杂的数据逻辑，及时沟通，尽量缩短耗时

十一、附录
1. 数据字典：（①罗列出整个设计中涉及的字段对应的标准字典数据<已纳入规范管理的标准字典可值罗列字典名字和说明在哪儿查看字典数据>，并说明标准字典来源。②罗列出整个设计中业务字典与标准字典的字典表对应清单）
每个数据字典的字典名都以复数命名，字典数据都包含开始日期，截止日期，是否停用3个字段，在附录中只罗列编码和名称，其他字段不做说明。
医院编码字典表：md.dim_hospitals
医院编码	医院名称	医院编码	医院名称
HID0101	四川大学华西医院	HID0113	雅安市人民医院
HID0102	绵竹市人民医院	HID0114	营山县人民医院
HID0103	华西上锦南府医院	HID0115	三亚市人民医院
HID0104	龙泉驿区第一人民医院	HID0116	成都市郫都区中医院
HID0105	眉山市人民医院	HID0117	四川大学华西天府医院
HID0106	资阳市中心医院	HID0118	武侯体检中心
HID0107	四川省第五人民医院	HID0119	川大校医院
HID0108	甘孜藏族自治州人民医院	HID0120	四川大学华西厦门医院
HID0109	宜宾市第二人民医院	HID0121	马边彝族自治县人民医院
HID0110	金堂县第一人民医院	HID0122	四川大学华西医院锦城医院(四川省公共综合临床中心)
HID0111	广安市人民医院	HID0123	四川大学华西峨眉医院
HID0112	双流区人民医院	HID0124	四川大学华西东部医院

医院院区编码字典表：md.dim_hosp_areas
医院院区编码	医院名称
YGF0001	主院区
YGF0002	温江院区
YGF0003	锦江院区
还未维护	天府院区
YGF9999	华西其他
还未维护	上锦医院
还未维护	天府医院
还未维护	厦门医院

业务系统编码字典表：md.
业务系统编码	业务系统名称	业务系统编码	业务系统名称
			
			

2. 参考文档：（列出方案设计过程中参考的行业标准、技术文档、规范）

3. 其他说明：（补充需要特别说明的内容，如方案的适用范围、后续优化方向等）
当前主题设计中没有包含自助机的操作类型和物理位置，后续可以增加自助机的操作类型和物理位置维度。
备注：模板可根据数据主题的复杂度增减内容，建议在主题设计阶段与技术团队充分沟通，确保数据主题与实际需求对齐。
