# 医保飞检SQL字段血缘关系汇总

## 一、主要数据表结构

### 1. 住院相关表
- `flycheck_realtime.settle_zy` - 住院结算主单
- `flycheck_realtime.settle_zy_detail` - 住院结算明细
- `flycheck_realtime.settle_zy_diagnosis` - 住院诊断信息表

### 2. 门诊相关表
- `flycheck_realtime.settle_mz` - 门诊结算主单
- `flycheck_realtime.settle_mz_detail` - 门诊结算明细

### 3. 辅助表
- `flycheck_realtime.dhc_taritem` - 收费项目表
- `flycheck_realtime.dhc_tarsubcate` - 收费子类别表
- `flycheck_realtime.mzh_table` - 门诊号表

## 二、字段血缘关系（按表分类）

### A. 住院结算主单 (settle_zy)
| 字段名 | 中文名称 | 数据类型 | 备注 |
|--------|----------|----------|------|
| zyh | 住院号 | VARCHAR(100) | 主键 |
| hisid | 结算单据号 | VARCHAR(100) | 主键 |
| patient_name | 患者姓名 | VARCHAR(100) | |
| patient_gender | 患者性别 | VARCHAR(30) | |
| patient_age | 患者年龄 | DECIMAL(16,2) | |
| id_card | 身份证号 | VARCHAR(100) | |
| admission_date | 入院日期 | DATE/DATETIME | |
| discharge_date | 出院日期 | DATE/DATETIME | |
| discharge_dept_name | 出院科室名称 | VARCHAR(30) | |
| benefit_type | 险种类型 | VARCHAR(50) | |
| if_local_flag | 异地标志 | VARCHAR(30) | |
| total_amount | 医疗总费用 | DECIMAL(16,2) | |
| bmi_pay_amount | 基本统筹支付 | DECIMAL(16,2) | |
| zyts | 住院天数 | DECIMAL(16,2) | |
| bah | 病案号 | VARCHAR(100) | |

### B. 住院结算明细 (settle_zy_detail)
| 字段名 | 中文名称 | 数据类型 | 备注 |
|--------|----------|----------|------|
| zyh | 住院号 | VARCHAR(100) | 关联键 |
| hisid | 结算单据号 | VARCHAR(100) | 关联键 |
| patient_id | 个人编码 | VARCHAR(100) | |
| fee_billdet_persno | 登记号 | VARCHAR(100) | |
| billing_dept_name | 开单科室名称 | VARCHAR(30) | |
| excute_dept_name | 执行科室名称 | VARCHAR(30) | |
| doctor_name | 开单医师姓名 | VARCHAR(30) | |
| item_id_hosp | 医院项目编码 | VARCHAR(50) | |
| item_name_hosp | 医院项目名称 | VARCHAR(100) | |
| item_id | 医保项目编码 | VARCHAR(50) | |
| item_name | 医保项目名称 | VARCHAR(100) | |
| unit_price | 单价 | DECIMAL(16,2) | |
| num | 数量 | DECIMAL(16,2) | |
| cost | 金额 | DECIMAL(16,2) | |
| bmi_convered_amount | 医保范围内金额 | DECIMAL(16,2) | |
| p_type | 支付类别 | DECIMAL(16,2) | |
| usage_date | 项目执行时间 | DATE/DATETIME | |
| bill_date | 结算日期 | DATE/DATETIME | |
| billing_time | 项目开单时间 | DATE/DATETIME | |
| package_unit | 计价单位 | VARCHAR(30) | |
| pbdstr | 费用明细流水号 | VARCHAR(100) | |
| sfzhm | 身份证号码 | VARCHAR(100) | |
| cblx | 参保类型 | VARCHAR(50) | |
| yblx | 医保类型 | VARCHAR(50) | |
| tcq | 统筹区 | VARCHAR(50) | |
| cbdqdm | 参保地区划代码 | VARCHAR(50) | |
| cbdqmc | 参保地区划名称 | VARCHAR(100) | |

### C. 住院诊断信息表 (settle_zy_diagnosis)
| 字段名 | 中文名称 | 数据类型 | 备注 |
|--------|----------|----------|------|
| hisid | 结算单据号 | VARCHAR(100) | 关联键 |
| zyh | 住院号 | VARCHAR(100) | 关联键 |
| admission_disease_name | 入院诊断名称 | VARCHAR(200) | |
| discharge_disease_name_main | 出院主诊断名称 | VARCHAR(50) | |
| zylczd | 疾病诊断 | VARCHAR(200) | |

### D. 门诊结算主单 (settle_mz)
| 字段名 | 中文名称 | 数据类型 | 备注 |
|--------|----------|----------|------|
| mzh | 门诊号 | VARCHAR(50) | 主键 |
| hisid | 结算单据号 | VARCHAR(100) | 主键 |
| patient_name | 患者姓名 | VARCHAR(100) | |
| patient_gender | 患者性别 | VARCHAR(6) | |
| patient_age | 患者年龄 | DECIMAL(16,2) | |
| id_card | 身份证号 | VARCHAR(100) | |
| admission_dept_name | 就诊科室名称 | VARCHAR(50) | |
| admission_disease_name | 诊断名称 | VARCHAR(300) | |
| benefit_type | 险种类型 | VARCHAR(50) | |
| if_local_flag | 异地标志 | VARCHAR(50) | |
| total_amount | 医疗总费用 | DECIMAL(16,2) | |

### E. 门诊结算明细 (settle_mz_detail)
| 字段名 | 中文名称 | 数据类型 | 备注 |
|--------|----------|----------|------|
| hisid | 结算单据号 | VARCHAR(100) | 关联键 |
| patient_id | 个人编码 | VARCHAR(100) | |
| excute_dept_name | 执行科室名称 | VARCHAR(50) | |
| doctor_name | 开单医师姓名 | VARCHAR(50) | |
| item_id_hosp | 医院项目编码 | VARCHAR(100) | |
| item_name_hosp | 医院项目名称 | VARCHAR(100) | |
| item_id | 医保项目编码 | VARCHAR(100) | |
| item_name | 医保项目名称 | VARCHAR(100) | |
| unit_price | 单价 | DECIMAL(16,2) | |
| num | 数量 | DECIMAL(16,2) | |
| cost | 金额 | DECIMAL(16,2) | |
| bmi_convered_amount | 医保范围内金额 | DECIMAL(16,2) | |
| p_type | 支付类别 | DECIMAL(16,2) | |
| usage_date | 项目执行时间 | DATE/DATETIME | |
| bill_date | 结算日期 | DATE/DATETIME | |
| billing_time | 项目开单时间 | DATE/DATETIME | |
| package_unit | 计价单位 | VARCHAR(30) | |
| pbd | 费用明细流水号 | VARCHAR(100) | |
| tcq | 统筹区 | VARCHAR(50) | |
| cbdqdm | 参保地区划代码 | VARCHAR(50) | |
| cbdqmc | 参保地区划名称 | VARCHAR(100) | |

### F. 辅助表字段
| 表名 | 字段名 | 中文名称 | 数据类型 | 备注 |
|------|--------|----------|----------|------|
| dhc_taritem | tari_code | 收费项目编码 | VARCHAR(50) | |
| dhc_tarsubcate | tarsc_desc | 费用类别 | VARCHAR(50) | |

## 三、常用字段映射关系

### 1. 患者基本信息
| 输出字段 | 住院来源 | 门诊来源 | 优先级 |
|----------|----------|----------|--------|
| 患者姓名 | settle_zy.patient_name | settle_mz.patient_name | 主单优先 |
| 患者性别 | settle_zy.patient_gender | settle_mz.patient_gender | 主单优先 |
| 患者年龄 | settle_zy.patient_age | settle_mz.patient_age | 主单优先 |
| 身份证号 | settle_zy.id_card | settle_mz.id_card | 主单优先 |

### 2. 就诊信息
| 输出字段 | 住院来源 | 门诊来源 | 优先级 |
|----------|----------|----------|--------|
| 就诊号 | settle_zy.zyh | settle_mz.mzh | 各自主键 |
| 就诊科室 | settle_zy.discharge_dept_name | settle_mz.admission_dept_name | 各自主单 |
| 入院诊断 | settle_zy_diagnosis.admission_disease_name | settle_mz.admission_disease_name | 各自来源 |
| 出院诊断 | settle_zy_diagnosis.discharge_disease_name_main | settle_mz.admission_disease_name | 住院有专门诊断表 |

### 3. 费用信息
| 输出字段 | 住院来源 | 门诊来源 | 优先级 |
|----------|----------|----------|--------|
| 项目编码 | settle_zy_detail.item_id_hosp | settle_mz_detail.item_id_hosp | 明细表 |
| 项目名称 | settle_zy_detail.item_name_hosp | settle_mz_detail.item_name_hosp | 明细表 |
| 单价 | settle_zy_detail.unit_price | settle_mz_detail.unit_price | 明细表 |
| 数量 | settle_zy_detail.num | settle_mz_detail.num | 明细表 |
| 金额 | settle_zy_detail.cost | settle_mz_detail.cost | 明细表 |
| 医保支付 | settle_zy_detail.bmi_convered_amount | settle_mz_detail.bmi_convered_amount | 明细表 |

### 4. 医保信息
| 输出字段 | 住院来源 | 门诊来源 | 优先级 |
|----------|----------|----------|--------|
| 参保类型 | settle_zy.benefit_type | settle_mz.benefit_type | 主单优先 |
| 异地标志 | settle_zy.if_local_flag | settle_mz.if_local_flag | 主单优先 |

## 四、血缘冲突字段分析

### 1. 身份证号字段冲突
- **settle_zy.id_card** (VARCHAR(100))
- **settle_zy_detail.sfzhm** (VARCHAR(100))
- **settle_mz.id_card** (VARCHAR(100))

**解决方案**: 优先使用主单表的id_card字段，明细表的sfzhm作为备用

### 2. 参保类型字段冲突
- **settle_zy.benefit_type** (VARCHAR(50))
- **settle_zy_detail.cblx** (VARCHAR(50))
- **settle_mz.benefit_type** (VARCHAR(50))

**解决方案**: 优先使用主单表的benefit_type字段，明细表的cblx作为扩展信息

### 3. 项目编码字段冲突
- **settle_zy_detail.item_id_hosp** (医院项目编码)
- **settle_zy_detail.item_id** (医保项目编码)
- **settle_mz_detail.item_id_hosp** (医院项目编码)
- **settle_mz_detail.item_id** (医保项目编码)

**解决方案**: 根据业务需求选择，通常医院项目编码用于内部管理，医保项目编码用于医保结算

### 4. 项目名称字段冲突
- **settle_zy_detail.item_name_hosp** (医院项目名称)
- **settle_zy_detail.item_name** (医保项目名称)
- **settle_mz_detail.item_name_hosp** (医院项目名称)
- **settle_mz_detail.item_name** (医保项目名称)

**解决方案**: 根据业务需求选择，通常医院项目名称更详细，医保项目名称更标准

### 5. 费用明细流水号冲突
- **settle_zy_detail.pbdstr** (VARCHAR(100))
- **settle_mz_detail.pbd** (VARCHAR(100))

**解决方案**: 住院使用pbdstr，门诊使用pbd，在UNION查询中需要统一字段名

### 6. 医保类型字段冲突
- **settle_zy_detail.yblx** (医保类型)
- **settle_mz_detail中无对应字段**

**解决方案**: 住院有专门的医保类型字段，门诊可能需要从其他字段推导或置空

### 7. 统筹区字段冲突
- **settle_zy_detail.tcq** (统筹区)
- **settle_mz_detail.tcq** (统筹区)

**解决方案**: 两表字段一致，可直接使用

### 8. 参保地区划字段冲突
- **settle_zy_detail.cbdqdm** (参保地区划代码)
- **settle_zy_detail.cbdqmc** (参保地区划名称)
- **settle_mz_detail.cbdqdm** (参保地区划代码)
- **settle_mz_detail.cbdqmc** (参保地区划名称)

**解决方案**: 两表字段一致，可直接使用

## 五、推荐的字段使用策略

### 1. 优先级原则
1. **主单表优先**: 患者基本信息优先从主单表获取
2. **明细表补充**: 费用相关信息从明细表获取
3. **专业表优先**: 诊断信息优先从专门的诊断表获取

### 2. 字段选择建议
```sql
-- 推荐的字段选择模式
SELECT 
    -- 患者信息：主单表优先
    COALESCE(主单.patient_name, '') AS 患者姓名,
    COALESCE(主单.id_card, 明细.sfzhm, '') AS 身份证号,
    
    -- 费用信息：明细表
    明细.item_id_hosp AS 项目编码,
    明细.item_name_hosp AS 项目名称,
    明细.cost AS 金额,
    
    -- 医保信息：优先主单，明细补充
    COALESCE(主单.benefit_type, 明细.cblx, '') AS 参保类型,
    明细.tcq AS 统筹区,
    明细.cbdqdm AS 参保地区划代码
```

### 3. 数据类型统一建议
所有输出字段建议使用CAST转换为VARCHAR类型，避免类型不匹配问题：
```sql
CAST(字段名 AS VARCHAR(长度)) AS 输出字段名
``` 