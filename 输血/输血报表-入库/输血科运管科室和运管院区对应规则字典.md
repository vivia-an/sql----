# 输血科运管科室和运管院区对应规则字典

## 概述

本文档基于输血报表相关SQL文件分析，整理了输血科系统中亚专业组代码与运管科室、运管院区的对应规则字典，为输血相关统计分析提供标准化的映射规则。

## 核心映射规则

### SQL映射逻辑
```sql
-- 根据亚专业组代码映射科室名称（输血科统一科室）
CASE 
    WHEN cw."亚专业组代码" IN ('G013', 'G053', 'G105', 'G111') THEN '输血科'
    ELSE '其他' -- 未映射的亚专业组代码
END as "科室名称"
```

### 院区映射逻辑
```sql
-- 院区字段支持但通常被注释
-- AND a."area_id" = 'A001'  -- 可用于指定特定院区
```

## 运管科室分类详情

### 1. 输血科（统一科室）

#### 1.1 输血科
- **亚专业组代码**: G013, G053, G105, G111
- **院区分类**: 全院区（默认不区分院区）
- **数据可用性**: 完整历史数据
- **业务范围**: 
  - 血液制品入库管理
  - 血液制品出库配送
  - 输血检验服务
  - 输血治疗服务

## 运管院区统计规则

### 院区支持字段
```sql
-- area_id字段存在但通常不使用分院区统计
a."area_id"  -- 院区标识字段
```

### 与LIS系统对比
- **LIS系统**: 复杂的多科室映射（8个科室/院区分类）
- **输血科系统**: 简化的单科室映射（1个统一科室）
- **院区处理**: 输血科默认不区分院区，LIS系统严格区分本部/永宁/天府

## 数据表血缘关系

### 核心表结构
1. **hid0101_orcl_lis_xhbis.bis_blood_apply** - 血液申请主表
2. **hid0101_orcl_lis_xhdata.lis_inspection_sample** - LIS标本表（关联检验）
3. **hid0101_orcl_lis_xhdata.lis_inspection_group** - LIS检验分组表
4. **hid0101_orcl_lis_xhsystem1.lis5_inspection_pgroup** - 亚专业组字典表

### 表关联逻辑
```sql
-- 血液申请到检验分组的关联路径
bis_blood_apply → lis_inspection_sample → lis_inspection_group → lis5_inspection_pgroup
```

## 完整映射字典表

| 亚专业组代码 | 运管科室名称 | 院区分类 | 数据可用性 | 备注 |
|-------------|-------------|----------|------------|------|
| G013, G053, G105, G111 | 输血科 | 全院区 | 完整历史数据 | 统一科室管理 |

## 统计计算规则

### 统计维度说明
- **合计**: 包含所有输血相关业务数据汇总
- **不区分院区**: 默认全院区统计，不做院区细分
- **收入分类**: 
  - 血费收入
  - 检验费收入  
  - 治疗费收入

### 业务量统计
输血科业务量通常按以下维度统计：
1. **入库统计**: 血液制品入库数量和金额
2. **出库统计**: 血液制品出库数量和金额
3. **检验统计**: 输血相关检验项目数量
4. **收入统计**: 各类收入分类汇总

## 应用场景

### 1. 按科室统计
- 输血科作为统一科室进行整体业务量统计
- 不需要复杂的科室内部细分

### 2. 业务流程统计
- 血液制品采购入库分析
- 血液制品使用出库分析
- 输血治疗服务量统计
- 输血检验服务量统计

### 3. 收入分析
- 血费收入占比分析
- 检验费收入趋势分析
- 治疗费收入构成分析

## 与LIS系统映射规则对比

### 复杂度对比
| 系统 | 科室数量 | 院区分类 | 映射复杂度 |
|------|----------|----------|------------|
| LIS系统 | 8个科室/院区 | 严格区分3个院区 | 高 |
| 输血科系统 | 1个统一科室 | 不区分院区 | 低 |

### 映射策略差异
- **LIS**: 按专业细分多个实验室科室
- **输血科**: 统一管理，不做内部科室细分

## 维护说明

### 字典更新原则
1. 新增亚专业组时，添加到输血科映射规则中
2. 如需支持院区统计，取消area_id字段注释
3. 保持与LIS系统映射规则的一致性

### 数据质量检查
1. 定期检查未映射的亚专业组代码
2. 验证输血科业务量统计的完整性
3. 确保收入分类统计的准确性

### 扩展支持
如需支持多院区统计，可参考以下扩展方案：
```sql
-- 扩展院区支持示例
CASE 
    WHEN a."area_id" = 'A001' THEN '本部输血科'
    WHEN a."area_id" = 'A002' THEN '永宁院区输血科'  
    WHEN a."area_id" = 'A003' THEN '天府院区输血科'
    ELSE '输血科'
END as "院区科室名称"
```

---
